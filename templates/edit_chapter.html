{% extends "base.html" %}

{% block content %}
    <div class="col-md-8 offset-md-2 mt-3">
        <h2 class="text-center mb-4">编辑章节</h2>
        <form method="POST" action="{{ url_for('edit_chapter', chapter_id=chapter.id) }}" enctype="multipart/form-data">
            <div class="mb-3">
                <label for="title" class="form-label">章节标题</label>
                <input type="text" class="form-control" id="title" name="title" value="{{ chapter.title }}" required>
            </div>
            <div class="mb-3">
                <label for="original_text" class="form-label">原文内容</label>
                <textarea id="original_text" name="original_text">{{ chapter.original_text }}</textarea>
            </div>
            <div class="mb-3">
                <label for="translation" class="form-label">译文内容</label>
                <textarea id="translation" name="translation">{{ chapter.translation }}</textarea>
            </div>
            <div class="mb-3">
                <label for="annotations" class="form-label">注释内容</label>
                <textarea id="annotations" name="annotations">{{ chapter.annotations }}</textarea>
            </div>
            <div class="mb-3">
                <label for="image" class="form-label">相关图片</label>
                {% if chapter.image_path %}
                    <img src="{{ url_for('static', filename=chapter.image_path) }}" class="img-fluid mb-3">
                {% endif %}
                <input type="file" class="form-control" id="image" name="image">
            </div>
            <button type="submit" class="btn btn-primary w-100" onclick="return validateForm()">保存修改</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/tinymce@6.7.0/tinymce.min.js"></script>
    <script>
        tinymce.init({
            selector: 'textarea',
            plugins: 'image code link lists media',
            toolbar: 'undo redo | styleselect | bold italic | alignleft aligncenter alignright | bullist numlist | link image media',
            height: 500,
            images_upload_url: '/upload_image',
            automatic_uploads: true
        });
        
        function validateForm() {
            if(tinymce.get('original_text').getContent() === '' || 
               tinymce.get('translation').getContent() === '') {
                alert('请填写所有必填字段');
                return false;
            }
            return true;
        }
    </script>
{% endblock %}