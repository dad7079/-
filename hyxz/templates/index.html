{% extends "base.html" %}

{% block content %}
    <!-- 目录栏 -->
    <div class="col-md-2 sidebar bg-light">
        <h4 class="text-center mt-3">目录</h4>
        <ul class="nav flex-column">
            {% for chapter in chapters %}
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showChapter({{ chapter.id }})">{{ chapter.title }}</a>
                </li>
            {% endfor %}
        </ul>
    </div>

    <!-- 默认图片 -->
    <div id="default-content" class="col-md-10 content-section">
        <img src="{{ url_for('static', filename='default.png') }}" class="img-fluid">
    </div>

    <!-- 原文栏 -->
    <div id="original-content" class="col-md-4 content-section original-text" style="display:none;">
        <div id="chapter-container">
            <h3 id="chapter-title"></h3>
            <p id="chapter-original" style="white-space: pre-line;"></p>
            <img id="chapter-image" src="" class="img-fluid mb-3" style="display:none;">
        </div>
    </div>

    <!-- 译文栏 -->
    <div id="translation-content" class="col-md-3 content-section translation" style="display:none;">
        <h3>译文</h3>
        <p id="chapter-translation" style="white-space: pre-line;"></p>
    </div>

    <!-- 注释栏 -->
    <div id="annotation-content" class="col-md-3 content-section" style="display:none;">
        <h3>注释</h3>
        <p id="chapter-annotation" style="white-space: pre-line;"></p>
    </div>

    <script>
        function showChapter(chapterId) {
            // 隐藏默认内容
            document.getElementById('default-content').style.display = 'none';
            
            // 显示内容区域
            document.getElementById('original-content').style.display = 'block';
            document.getElementById('translation-content').style.display = 'block';
            document.getElementById('annotation-content').style.display = 'block';
            
            // 获取章节数据并填充
            fetch(`/get_chapter/${chapterId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('chapter-title').textContent = data.title;
                    document.getElementById('chapter-original').innerHTML = data.original_text;
                    document.getElementById('chapter-translation').innerHTML = data.translation;
                    document.getElementById('chapter-annotation').innerHTML = data.annotations;
                    
                    if(data.image_path) {
                        document.getElementById('chapter-image').src = `/static/${data.image_path}`;
                        document.getElementById('chapter-image').style.display = 'block';
                    } else {
                        document.getElementById('chapter-image').style.display = 'none';
                    }
                });
        }
    </script>
{% endblock %}